# Нейронная сеть распознавания рукописного текста с помощью TensorFlow


Система распознавания рукописного текста (HTR), реализованная с помощью TensorFlow (TF) и обученная на базе автономного набора данных HTR I AM.
Модель принимает **изображения отдельных слов или строк текста (нескольких слов) в качестве входных данных** и **выводит распознанный текст**.
3/4 слов из набора проверки распознаны правильно, а частота ошибок символов составляет около 10%.

![htr](./doc/htr.png)


## Запустите демо-версию

* Загрузите предварительно обученную модель
  * [Модель, обученная на словесных изображениях](https://github.com/Stolzie071/Neural-network-text-recognition-model-/tree/main/model): 
    обрабатывает только отдельные слова для каждого изображения, но дает лучшие результаты в наборе данных IAM word.

* Поместите содержимое загруженного zip-файла в каталог `model` репозитория  
* Перейдите в каталог `src` 
* Запустите код вывода:
  * Выполните `python main.py ` чтобы запустить модель

Входные изображения и ожидаемые выходные данные показаны ниже при использовании модели текстовых строк.

![test](./data/word.png)
```
> python main.py
Init with stored values from ../model/snapshot-13
Recognized: "word"
Probability: 0.9806370139122009
```

![test](./data/line.png)

```
> python main.py --img_file ../data/line.png
Init with stored values from ../model/snapshot-13
Recognized: "or work on line level"
Probability: 0.6674373149871826
```


## Декодер поиска по словесному лучу

Декодер поиска по словесному лучу можно использовать вместо двух декодеров, поставляемых вместе с TF.
Слова ограничены словами, содержащимися в словаре, но произвольные строки символов, не состоящие из слов (цифры, знаки препинания), все равно могут быть распознаны.
На следующем рисунке показан пример, для которого word beam search способен распознать правильный текст, в то время как другие декодеры терпят неудачу.

![decoder_comparison](./doc/decoder_comparison.png)


## Обучающая модель на основе набора данных IAM


Предварительно обученная модель word была обучена с помощью этой команды на GTX 1050 Ti:
```
python main.py --mode train --fast --data_dir path/to/iam  --batch_size 500 --early_stopping 15
```

И линейная модель:
```
python main.py --mode train --fast --data_dir path/to/iam  --batch_size 250 --early_stopping 10
```


### Быстрая загрузка изображений

Загрузка и декодирование файлов изображений png с диска является узким местом даже при использовании только небольшого графического процессора.
База данных LMDB используется для ускорения загрузки изображений.

Набор данных должен располагаться на твердотельном накопителе.
При использовании опции `--fast` и GTX 1050 Ti обучение отдельным словам занимает около 3 часов при размере пакета 500.

Обучение работе с текстовыми строками занимает немного больше времени.



## Ссылки на литературу:
* [Создание системы распознавания рукописного текста с использованием TensorFlow](https://towardsdatascience.com/2326a3487cd5)
* [Распознавание рукописного текста в исторических документах](https://repositum.tuwien.ac.at/obvutwhs/download/pdf/2874742)
* [Поиск по Словесному Лучу: Коннекционистский темпоральный Алгоритм декодирования классификации](https://repositum.tuwien.ac.at/obvutwoa/download/pdf/2774578)

